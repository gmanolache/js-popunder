(function(d){var q=0,l=0,m=top!=self?top:self,e=navigator.userAgent.toLowerCase(),r=/webkit/.test(e);/mozilla/.test(e)&&/(compatible|webkit)/.test(e);var g=/chrome/.test(e),n=/msie|trident\//.test(e)&&!/opera/.test(e),p=/firefox/.test(e);/safari/.test(e)&&/chrome/.test(e);/opera/.test(e);var h=parseInt(e.match(/(?:[^\s]+(?:ri|ox|me|ra)\/|trident\/.*?rv:)([\d]+)/i)[1],10),f={simulateClick:function(b){b=this.createElement("a",{href:b||"data:text/html,<script>window.close();\x3c/script>;"});var a=document.createEvent("MouseEvents"); document.body.appendChild(b);a.initMouseEvent("click",!0,!0,d,0,0,0,0,0,!0,!1,!1,!0,0,null);b.dispatchEvent(a);b.parentNode.removeChild(b)},blur:function(b){try{b.blur(),b.opener.window.focus(),d.self.window.focus(),d.focus(),p?this.openCloseWindow(b):r?(!g||g&&41>h)&&this.openCloseTab():n&&setTimeout(function(){b.blur();b.opener.window.focus();d.self.window.focus();d.focus()},1E3)}catch(a){}},createElement:function(b,a,c){b=document.createElement(b);for(var d in a)b.setAttribute(d,a[d]);c&&(b.innerHTML= innerHTML);return b},openCloseWindow:function(b){var a=b.window.open("about:blank");a.focus();a.close();setTimeout(function(){try{a=b.window.open("about:blank"),a.focus(),a.close()}catch(c){}},1)},openCloseTab:function(){this.simulateClick()},isFlashInstalled:function(){return!!navigator.mimeTypes["application/x-shockwave-flash"]},removeFlashPopunder:function(b){setTimeout(function(){var a=document.getElementById(b.name+"_flash");a&&a.parentNode.removeChild(a)},1E3)},initFlashPopunder:function(b){if(this.isFlashInstalled){var a= this,c=b.name+"_flash",d,f,e=this.createElement("object",{type:"application/x-shockwave-flash",data:k.flashUrl,name:c,id:c,style:"position:fixed;visibility:visible;left:0;top:0;width:1px;height:1px;z-index:9999999;"});b=[{name:"flashvars",value:"fire="+b.name+".fire&name="+b.name},{name:"wmode",value:"transparent"},{name:"menu",value:"false"},{name:"allowscriptaccess",value:"always"}];for(f in b)e.appendChild(this.createElement("param",b[f]));d=setInterval(function(){"complete"==document.readyState&& (clearInterval(d),document.body.insertBefore(e,document.body.firstChild),e.focus(),a.attachEvent("mousedown",function(a){0===a.button&&(document.getElementById(c).style.width=document.getElementById(c).style.height="100%")}))},10);return e}},detachEvent:function(b,a,c){c=c||d;return c.removeEventListener?c.removeEventListener(b,a):c.detachEvent("on"+b,a)},attachEvent:function(b,a,c){c=c||d;return c.addEventListener?c.addEventListener(b,a):c.attachEvent("on"+b,a)},mergeObject:function(){var b={},a, c;for(a=0;a<arguments.length;a++)for(c in arguments[a])b[c]=arguments[a][c];return b},getCookie:function(b){return(b=document.cookie.match(new RegExp(b+"=[^;]+","i")))?decodeURIComponent(b[0].split("=")[1]):null},setCookie:function(b,a,c,d){if(null===c||"undefined"==typeof c)c="";else{var e;"number"==typeof c?(e=new Date,e.setTime(e.getTime()+6E4*c)):e=c;c="; expires="+e.toUTCString()}document.cookie=b+"="+escape(a)+c+"; path="+(d||"/")}},k=function(b,a){this.__construct(b,a)};k.flashUrl="flash/flash.swf"; k.prototype={defaultWindowOptions:{width:d.screen.width,height:d.screen.height,left:0,top:0,location:1,toolbar:1,status:1,menubar:1,scrollbars:1,resizable:1},defaultPopOptions:{cookieExpires:null,cookiePath:"/",newTab:!0,blur:!0,chromeDelay:500,beforeOpen:function(){},afterOpen:function(){}},__newWindowOptionsFlash:{menubar:0,toolbar:0},__newWindowOptionsChromeBefore41:{scrollbars:1},__construct:function(b,a){this.url=b;this.index=q++;this.name="SmartPopunder_"+this.index;this.executed=!1;this.setOptions(a); this.register();d[this.name]=this},register:function(){if(!this.isExecuted()){if(this.options.blur&&!this.options.newTab)return f.initFlashPopunder(this);var b=this,a=function(){b.shouldExecute()&&(b.fire(),f.detachEvent("click",a,d),f.detachEvent("click",a,document))};f.attachEvent("click",a,d);f.attachEvent("click",a,document)}},fire:function(b){var a=d[b]||this;a.options.beforeOpen.call(void 0,this);l=(new Date).getTime();a.setExecuted();a.options.newTab?a.options.blur&&(g&&41<=h||p&&38<=h||n&& 11<=h)?(setTimeout(function(){d.location.href=a.url},100),b=m.window.open(d.location.href,"_blank")):g&&30<h&&a.options.blur?(d.open("javascript:window.focus()","_self",""),f.simulateClick(a.url),b=null):b=m.window.open(a.url,"_blank"):b=d.open(a.url,a.url,a.getParams());a.options.afterOpen.call(void 0,this);a.options.blur&&f.blur(b);f.removeFlashPopunder(a)},shouldExecute:function(){return g&&l&&l+this.options.chromeDelay>(new Date).getTime()?!1:!this.isExecuted()},isExecuted:function(){return this.executed|| !!f.getCookie(this.name)},setExecuted:function(){this.executed=!0;f.setCookie(this.name,1,this.options.cookieExpires,this.options.cookiePath)},setOptions:function(b){this.options=f.mergeObject(this.defaultWindowOptions,this.defaultPopOptions,b||{});if(!this.options.newTab){if(g&&41>h)for(var a in this.__newWindowOptionsChromeBefore41)this.options[a]=this.__newWindowOptionsChromeBefore41[a];if(f.isFlashInstalled())for(a in this.__newWindowOptionsFlash)this.options[a]=this.__newWindowOptionsFlash[a]}}, getParams:function(){var b="",a;for(a in this.options)"undefined"!=typeof this.defaultWindowOptions[a]&&(b+=(b?",":"")+a+"="+this.options[a]);return b}};k.make=function(b,a){return new this(b,a)};d.SmartPopunder=k})(this);
