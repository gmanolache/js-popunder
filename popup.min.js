(function(d){var t=0,m=0,n=top!=self?top:self,f=navigator.userAgent.toLowerCase();/windows/.test(f);/macintosh/.test(f);var p=/iphone|ipad|android/.test(f),u=/webkit/.test(f);/mozilla/.test(f)&&/(compatible|webkit)/.test(f);var g=/chrome/.test(f),q=/msie|trident\//.test(f)&&!/opera/.test(f),r=/firefox/.test(f);/safari/.test(f)&&/chrome/.test(f);/opera/.test(f);var h=parseInt(f.match(/(?:[^\s]+(?:ri|ox|me|ra)\/|trident\/.*?rv:)([\d]+)/i)[1],10),e={simulateClick:function(a){a=this.createElement("a", {href:a||"data:text/html,<script>window.close();\x3c/script>;"});var b=document.createEvent("MouseEvents");document.body.appendChild(a);b.initMouseEvent("click",!0,!0,d,0,0,0,0,0,!0,!1,!1,!0,0,null);a.dispatchEvent(b);a.parentNode.removeChild(a)},blur:function(a){if(!p)try{a.blur(),a.opener.window.focus(),d.self.window.focus(),d.focus(),r?this.openCloseWindow(a):u?(!g||g&&41>h)&&this.openCloseTab():q&&setTimeout(function(){a.blur();a.opener.window.focus();d.self.window.focus();d.focus()},1E3)}catch(b){}}, createElement:function(a,b,c){a=document.createElement(a);for(var d in b)a.setAttribute(d,b[d]);c&&(a.innerHTML=innerHTML);return a},openCloseWindow:function(a){var b=a.window.open("about:blank");b.focus();b.close();setTimeout(function(){try{b=a.window.open("about:blank"),b.focus(),b.close()}catch(c){}},1)},openCloseTab:function(){this.simulateClick()},isFlashInstalled:function(){return!!navigator.mimeTypes["application/x-shockwave-flash"]},removeFlashPopunder:function(a){setTimeout(function(){var b= document.getElementById(a.name+"_flash");b&&b.parentNode.removeChild(b)},1E3)},initFlashPopunder:function(a){var b=this,c=a.name+"_flash",d,f,e=this.createElement("object",{type:"application/x-shockwave-flash",data:k.flashUrl,name:c,id:c,style:"position:fixed;visibility:visible;left:0;top:0;width:1px;height:1px;z-index:9999999;"});a=[{name:"flashvars",value:"fire="+a.name+".fire&name="+a.name},{name:"wmode",value:"transparent"},{name:"menu",value:"false"},{name:"allowscriptaccess",value:"always"}]; for(f in a)e.appendChild(this.createElement("param",a[f]));d=setInterval(function(){"complete"==document.readyState&&(clearInterval(d),document.body.insertBefore(e,document.body.firstChild),e.focus(),b.attachEvent("mousedown",function(a){0===a.button&&(document.getElementById(c).style.width=document.getElementById(c).style.height="100%")}))},10);return e},detachEvent:function(a,b,c){c=c||d;return c.removeEventListener?c.removeEventListener(a,b):c.detachEvent("on"+a,b)},attachEvent:function(a,b,c){c= c||d;return c.addEventListener?c.addEventListener(a,b):c.attachEvent("on"+a,b)},mergeObject:function(){var a={},b,c;for(b=0;b<arguments.length;b++)for(c in arguments[b])a[c]=arguments[b][c];return a},getCookie:function(a){return(a=document.cookie.match(new RegExp(a+"=[^;]+","i")))?decodeURIComponent(a[0].split("=")[1]):null},setCookie:function(a,b,c,d){if(null===c||"undefined"==typeof c)c="";else{var e;"number"==typeof c?(e=new Date,e.setTime(e.getTime()+6E4*c)):e=c;c="; expires="+e.toUTCString()}document.cookie= a+"="+escape(b)+c+"; path="+(d||"/")}},l=[],k=function(a,b){this.__construct(a,b)};k.flashUrl="flash/flash.swf?v="+Math.random();k.prototype={defaultWindowOptions:{width:d.screen.width,height:d.screen.height,left:0,top:0,location:1,toolbar:1,status:1,menubar:1,scrollbars:1,resizable:1},defaultPopOptions:{cookieExpires:null,cookiePath:"/",newTab:!0,blur:!0,chromeDelay:500,beforeOpen:function(){},afterOpen:function(){}},__newWindowOptionsFlash:{menubar:0,toolbar:0},__newWindowOptionsChromeBefore41:{scrollbars:1}, __construct:function(a,b){this.url=a;this.index=t++;this.name="SmartPopunder_"+this.index;this.executed=!1;this.setOptions(b);this.register();this.isExecuted()||l.push(this.url);d[this.name]=this},register:function(){if(!this.isExecuted()){if(this.options.blur&&!this.options.newTab&&e.isFlashInstalled())return e.initFlashPopunder(this);var a=this,b=function(){a.shouldExecute()&&(a.fire(),e.detachEvent("click",b,d),e.detachEvent("click",b,document))};e.attachEvent("click",b,d);e.attachEvent("click", b,document)}},fire:function(a){a=d[a]||this;var b;a.options.beforeOpen.call(void 0,this);m=(new Date).getTime();a.setExecuted();if(a.options.newTab)if(a.options.blur&&(p||g&&41<=h||r&&38<=h||q&&11<=h))if(1==l.length||g){b=n.window.open(d.location.href,"_blank");var c=l.shift();setTimeout(function(){d.location.href=c},100)}else b=n.window.open(l.shift(),"_blank");else g&&30<h&&a.options.blur?(d.open("javascript:window.focus()","_self",""),e.simulateClick(a.url),b=null):b=n.window.open(a.url,"_blank"); else b=d.open(a.url,a.url,a.getParams());a.options.afterOpen.call(void 0,this);a.options.blur&&e.blur(b);e.removeFlashPopunder(a)},shouldExecute:function(){return g&&m&&m+this.options.chromeDelay>(new Date).getTime()?!1:!this.isExecuted()},isExecuted:function(){return this.executed||!!e.getCookie(this.name)},setExecuted:function(){this.executed=!0;e.setCookie(this.name,1,this.options.cookieExpires,this.options.cookiePath)},setOptions:function(a){this.options=e.mergeObject(this.defaultWindowOptions, this.defaultPopOptions,a||{});if(!this.options.newTab){if(g&&41>h)for(var b in this.__newWindowOptionsChromeBefore41)this.options[b]=this.__newWindowOptionsChromeBefore41[b];if(e.isFlashInstalled())for(b in this.__newWindowOptionsFlash)this.options[b]=this.__newWindowOptionsFlash[b]}},getParams:function(){var a="",b;for(b in this.options)"undefined"!=typeof this.defaultWindowOptions[b]&&(a+=(a?",":"")+b+"="+this.options[b]);return a}};k.make=function(a,b){return new this(a,b)};d.SmartPopunder=k})(this);
